    sfreq = raw_recons.info['sfreq']
    max_time = raw_recons.times[-1] - 8.0  # 预计算边界
    
    # 使用列表推导式（快3-5倍）
    events_valid_annots = [
        (ann, int(ann['onset'] * sfreq))
        for ann in selected_annots
        if 8.0 <= ann['onset'] <= max_time
    ]
    
    # 分离结果
    if events_valid_annots:
        valid_annotations, sample_points = zip(*events_valid_annots)
        events_list = [[sp, 0, 1] for sp in sample_points]
        valid_annotations = list(valid_annotations)
    else:
        events_list = []
        valid_annotations = []
    
    print(f"Converted to {len(events_list)} valid events within data range")
